# 기능 명세서

## 1. 추억 아카이브 업로드

### 기능 설명
사용자가 특정 날짜에 대한 사진과 글을 업로드할 수 있습니다.

### 세부 요구사항
- ✅ "Archive Memory" 버튼 클릭시 업로드 모달 표시
- ✅ 날짜 선택 (12월 1일 ~ 25일)
- ✅ 사진 업로드 (JPG, PNG, GIF, WEBP, 최대 10MB)
- ✅ 글 작성 (최대 500자)
- ✅ 업로드 완료시 "Archive Complete!" 토스트 2초간 표시

### 제약 조건
- ✅ 한 날짜당 최대 5개의 추억
- ✅ 한 사용자(세션)당 1개의 추억만 업로드 가능
- ✅ 2025년 12월 31일 자정까지만 업로드 가능

### 구현 상태
- [x] 백엔드 API (`/api/memories`)
- [x] 업로드 모달 컴포넌트
- [x] 이미지 유효성 검사
- [x] 글 유효성 검사
- [ ] 메인 페이지에 "Archive Memory" 버튼 통합 (피그마 디자인 대기)

## 2. 업로드 제한 및 안내

### 기능 설명
이미 업로드한 사용자가 다시 업로드를 시도할 때 안내 메시지를 표시합니다.

### 세부 요구사항
- ✅ 세션 기반 업로드 여부 추적
- ✅ 이미 업로드한 경우 "One user can upload only one memory :)" 토스트 2초간 표시

### 구현 상태
- [x] 세션 ID 생성 및 관리 (`lib/session.ts`)
- [x] 세션 체크 API (`/api/check-session`)
- [x] 로컬 스토리지 기반 추적
- [ ] 메인 페이지에서 세션 체크 통합

## 3. 날짜별 추억 개수 표시

### 기능 설명
각 날짜 창문에 마우스를 올리면 등록된 추억 개수를 툴팁으로 표시합니다.

### 세부 요구사항
- ✅ 날짜 호버시 (n/5) 형식으로 표시
- ✅ 실시간 개수 조회

### 구현 상태
- [x] 개수 조회 API (`/api/memories/count`)
- [ ] 캘린더 UI 컴포넌트 (피그마 디자인 대기)
- [ ] 툴팁 표시 기능

## 4. 추억 조회

### 기능 설명
날짜를 클릭하면 좌측 사이드바로 해당 날짜의 추억들을 조회할 수 있습니다.

### 세부 요구사항
- ✅ 날짜 클릭시 좌측 사이드바 표시
- ✅ 해당 날짜의 모든 추억 표시 (사진 + 글)
- ✅ 추억이 없을 경우 안내 메시지

### 구현 상태
- [x] 추억 조회 API (`/api/memories`)
- [x] 사이드바 컴포넌트 (`MemorySidebar`)
- [ ] 캘린더 UI에서 날짜 클릭 이벤트 연결

## 5. 날짜 기반 공개 제한

### 기능 설명
각 날짜의 추억은 해당 날짜 자정부터 공개됩니다.

### 세부 요구사항
- ✅ 해당 날짜 자정 전에는 조회 불가
- ✅ 자정 전 클릭시 "It will open at midnight on that day." 안내 팝업

### 구현 상태
- [x] 날짜 공개 여부 체크 함수 (`lib/utils.ts` - `isDateUnlocked`)
- [ ] 캘린더 UI에서 날짜 잠금 상태 표시
- [ ] 안내 팝업 모달

## 6. 업로드 기간 제한

### 기능 설명
2025년 12월 31일 자정까지만 추억을 업로드할 수 있습니다.

### 세부 요구사항
- ✅ 기간 종료 후 업로드 불가
- ✅ 기간 체크 함수

### 구현 상태
- [x] 업로드 기간 체크 함수 (`lib/utils.ts` - `isUploadPeriodValid`)
- [ ] 메인 페이지에서 기간 만료시 "Archive Memory" 버튼 비활성화

## 7. 토스트 알림

### 기능 설명
다양한 상황에서 사용자에게 피드백을 제공합니다.

### 토스트 메시지 종류
- ✅ 업로드 완료: "Archive Complete!"
- ✅ 중복 업로드 시도: "One user can upload only one memory :)"
- ✅ 날짜당 5개 초과: "This date already has 5 memories"
- ✅ 에러 메시지

### 구현 상태
- [x] Toast 컴포넌트
- [x] useToast 커스텀 훅
- [x] 자동 2초 후 사라짐
- [ ] 메인 페이지에 통합

## 구현 우선순위

### Phase 1: 사전 개발 작업 (완료)
- [x] 프로젝트 초기화
- [x] 타입 정의
- [x] Supabase 스키마 설계
- [x] API Routes 구현
- [x] 유틸리티 함수
- [x] 기본 컴포넌트

### Phase 2: UI 개발 (피그마 디자인 대기)
- [ ] 메인 캘린더 레이아웃
- [ ] 날짜 창문 컴포넌트
- [ ] "Archive Memory" 버튼
- [ ] 날짜 호버 효과 및 툴팁
- [ ] 날짜 잠금 상태 표시

### Phase 3: 기능 통합
- [ ] 모든 컴포넌트를 메인 페이지에 통합
- [ ] 상태 관리 최적화
- [ ] 에러 핸들링 강화

### Phase 4: 테스트 및 최적화
- [ ] 기능 테스트
- [ ] 반응형 디자인 확인
- [ ] 성능 최적화
- [ ] 접근성 개선

## 기술적 고려사항

### 세션 관리
- localStorage 기반 세션 ID 관리
- 브라우저 쿠키 삭제시에도 세션 유지
- 서버 측에서도 중복 검증 (데이터베이스 트리거)

### 이미지 처리
- Supabase Storage 사용
- 클라이언트 측 파일 유효성 검사
- 이미지 최적화 고려 (추후)

### 실시간 업데이트
- 추억 업로드 후 개수 새로고침
- 필요시 Supabase Realtime 기능 활용 고려

### 보안
- Row Level Security (RLS) 활성화
- 익명 사용자도 읽기/쓰기 가능하지만 제약 조건 적용
- SQL Injection 방지 (Supabase 클라이언트 사용)

